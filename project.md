# Caddy CLI - Проект управления веб-сервером Caddy

## Обзор проекта

CLI-приложение на Bun.SH для управления конфигурацией веб-сервера Caddy, работающего в Docker-контейнере. Приложение позволяет просматривать, добавлять и редактировать сайты с привязкой к Docker-контейнерам.

## Структура проекта

```
caddy_cli/
├── src/
│   ├── main.ts          # Точка входа
│   ├── db.ts            # SQLite база данных
│   ├── caddyfile.ts     # Парсинг и генерация Caddyfile
│   ├── docker.ts        # Работа с Docker API
│   ├── ui.ts            # CLI интерфейс (clack/prompts)
│   └── banner.ts        # ASCII баннер
├── data/
│   └── caddy_cli.db     # SQLite база данных
├── package.json
└── tsconfig.json
```

## Технологический стек

- **Bun.SH** - Runtime (встроенные SQLite и http клиент)
- **SQLite** - Встроенная база данных Bun
- **clack/prompts** - TUI библиотека для CLI
- **Docker API** - Чтение контейнеров через Docker socket

## Функциональность

### 1. Просмотр списка сайтов
- Отображение всех доменов из Caddyfile
- Показ привязанного контейнера для каждого домена
- Статус сайта (активен/неактивен)

### 2. Добавление нового сайта
- Ввод доменного имени
- Выбор Docker-контейнера из списка доступных в сети caddy
- Правило: 1 домен = 1 контейнер

### 3. Редактирование сайта
- Изменение привязки домена к контейнеру
- Выбор нового контейнера из списка
- Удаление сайта из конфигурации

### 4. Сохранение и перезагрузка
- Генерация нового Caddyfile
- Сохранение в ./caddy/config/Caddyfile
- Перезагрузка Caddy через `docker exec caddy caddy reload`

## База данных (SQLite)

### Таблица sites
| Поле | Тип | Описание |
|------|-----|----------|
| id | INTEGER PRIMARY KEY | ID записи |
| domain | TEXT UNIQUE | Доменное имя |
| container_name | TEXT | Имя Docker контейнера |
| container_port | TEXT | Порт контейнера (по умолчанию) |
| created_at | DATETIME | Дата создания |
| updated_at | DATETIME | Дата обновления |

## Парсинг Caddyfile

Caddyfile содержит блоки:
```
domain.tld {
    reverse_proxy container_name:port
}
```

Нужно извлекать:
- Домен (первая строка блока)
- Имя контейнера из reverse_proxy
- Порт (если указан)

## Docker интеграция

- Чтение контейнеров из сети `caddy` через Docker API
- Фильтрация только работающих контейнеров
- Получение имени и IP адреса контейнера

## UI/UX

### Баннер при запуске
```
  █████╗ ███████╗ ██████╗██╗██╗      ███████╗██╗     ██╗██╗  ██╗
 ██╔══██╗██╔════╝██╔════╝██║██║      ██╔════╝██║     ██║╚██╗██╔╝
 ███████║███████╗██║     ██║██║█████╗█████╗  ██║     ██║ ╚███╔╝ 
 ██╔══██║╚════██║██║     ██║██║╚════╝██╔══╝  ██║     ██║ ██╔██╗ 
 ██║  ██║███████║╚██████╗██║██║      ██║     ███████╗██║██╔╝ ██╗
 ╚═╝  ╚═╝╚══════╝ ╚═════╝╚═╝╚═╝      ╚═╝     ╚══════╝╚═╝╚═╝  ╚═╝
```

### Главное меню
- Список сайтов с пагинацией
- [A] Добавить сайт
- [E] Редактировать сайт
- [D] Удалить сайт
- [R] Перезагрузить Caddy
- [Q] Выход

## Конфигурация

Пути по умолчанию:
- Caddyfile: `./caddy/config/Caddyfile`
- Docker socket: `/var/run/docker.sock`
- База данных: `./caddy_cli/data/caddy_cli.db`

## Примеры использования

```bash
# Запуск приложения
bun run src/main.ts

# Первый запуск - импорт из существующего Caddyfile
# Приложение предложит импортировать текущие сайты
```

## Ограничения

1. **Один контейнер на домен** - нельзя привязать несколько доменов к одному контейнеру (можно реализовать позже)
2. **Ручная генерация HTTPS** - приложение использует глобальные настройки из оригинального Caddyfile
3. **Сеть caddy** - контейнеры должны быть в сети `caddy`
